<!DOCTYPE html>
<html>
<head>
    <style>
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        .number-btn, .control-btn {
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #ccc;
            background: white;
        }
        .selected { background-color: #4CAF50; color: white; }
        .active-multiplier { background-color: #ff4444; color: white; }
        .controls { margin: 20px 0; }
        .throws {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .throw {
            padding: 10px;
            border: 1px solid #ccc;
            min-width: 100px;
            text-align: center;
        }
        .throw-total {
            padding: 15px;
            border: 1px solid #ccc;
            min-width: 150px;
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            display: none;
        }
        .score { font-size: 24px; margin: 20px 0; }
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            font-size: 18px;
        }
        .input-area {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        #manualInput {
            padding: 10px;
            font-size: 16px;
            width: 100px;
        }
        .voice-active .throws { display: none; }
        .voice-active .throw-total { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="score">Score: <span id="currentScore">501</span></div>
        <div class="stats">
            <div>Kolo: <span id="roundCounter">1</span></div>
            <div>Celkem ≈°ipek: <span id="totalDarts">0</span></div>
        </div>
        <div class="throws">
            <div class="throw" id="throw1">-</div>
            <div class="throw" id="throw2">-</div>
            <div class="throw" id="throw3">-</div>
        </div>
        <div class="throw-total" id="throwTotal">-</div>
        <div class="input-area">
            <input type="number" id="manualInput" placeholder="Zadej body">
            <button onclick="addManualScore()" class="control-btn">P≈ôidat</button>
        </div>
        <div class="controls">
            <button id="voiceBtn" class="control-btn">üé§ Hlasov√Ω vstup</button>
            <button onclick="toggleMultiplier(2)" id="doubleBtn" class="control-btn">Double</button>
            <button onclick="toggleMultiplier(3)" id="tripleBtn" class="control-btn">Triple</button>
            <button onclick="undoLastThrow()" class="control-btn">‚Ü©Ô∏è Zpƒõt</button>
            <button onclick="resetGame()" class="control-btn">üîÑ Reset</button>
        </div>
        <div id="numberGrid" class="number-grid"></div>
    </div>

    <script>
        let currentScore = 501;
        let throws = [];
        let history = [{score: 501, throws: []}];
        let activeMultiplier = 1;
        let currentRound = 1;
        let totalDarts = 0;
        let isVoiceMode = false;
        const maxThrows = 3;

        function convertSpokenNumberToCzech(text) {
            const numberWords = {
                'nula': 0,
                'jedna': 1,
                'dvƒõ': 2,
                't≈ôi': 3,
                'ƒçty≈ôi': 4,
                'pƒõt': 5,
                '≈°est': 6,
                'sedm': 7,
                'osm': 8,
                'devƒõt': 9,
                'deset': 10,
                'jeden√°ct': 11,
                'dvan√°ct': 12,
                't≈ôin√°ct': 13,
                'ƒçtrn√°ct': 14,
                'patn√°ct': 15,
                '≈°estn√°ct': 16,
                'sedmn√°ct': 17,
                'osmn√°ct': 18,
                'devaten√°ct': 19,
                'dvacet': 20
            };

            // Convert text to lowercase and remove extra spaces
            text = text.toLowerCase().trim();
            
            // Check if the text is directly in our dictionary
            if (numberWords.hasOwnProperty(text)) {
                return numberWords[text];
            }
            
            // If it's already a number (as string), parse it
            const numericValue = parseInt(text.replace(/\D/g, ''));
            if (!isNaN(numericValue)) {
                return numericValue;
            }
            
            return null;
        }

        function addManualScore() {
            const input = document.getElementById('manualInput');
            const value = parseInt(input.value);
            if (!isNaN(value) && value >= 0) {
                if (isVoiceMode) {
                    addVoiceScore(value);
                } else {
                    addScore(value);
                }
                input.value = '';
            }
        }

        document.getElementById('manualInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addManualScore();
            }
        });

        function addScore(points) {
            if (throws.length >= maxThrows) return;
            
            currentScore -= points;
            throws.push({
                base: points,
                multiplier: 1,
                points: points
            });
            totalDarts++;
            saveState();
            updateDisplay();
            
            if (throws.length >= maxThrows) {
                setTimeout(() => {
                    throws = [];
                    currentRound++;
                    saveState();
                    updateDisplay();
                }, 2000);
            }
        }

        function addVoiceScore(points) {
            currentScore -= points;
            totalDarts += 3;
            history.push({
                score: currentScore,
                voiceTotal: points,
                round: currentRound,
                totalDarts: totalDarts
            });
            updateDisplay();
            
            setTimeout(() => {
                currentRound++;
                throws = [];
                history.push({
                    score: currentScore,
                    voiceTotal: null,
                    round: currentRound,
                    totalDarts: totalDarts
                });
                updateDisplay();
            }, 2000);
        }

        function updateDisplay() {
            document.getElementById('currentScore').textContent = currentScore;
            document.getElementById('roundCounter').textContent = currentRound;
            document.getElementById('totalDarts').textContent = totalDarts;
            
            if (isVoiceMode) {
                const lastState = history[history.length - 1];
                document.getElementById('throwTotal').textContent = 
                    lastState.voiceTotal !== null ? `${lastState.voiceTotal}` : '-';
            } else {
                for (let i = 1; i <= maxThrows; i++) {
                    const throwElement = document.getElementById(`throw${i}`);
                    const throwValue = throws[i-1];
                    throwElement.textContent = throwValue ? 
                        `${throwValue.points} (${throwValue.base}√ó${throwValue.multiplier})` : 
                        '-';
                }
            }
        }

        function saveState() {
            history.push({
                score: currentScore,
                throws: [...throws],
                round: currentRound,
                totalDarts: totalDarts
            });
        }

        function toggleMultiplier(value) {
            if (!isVoiceMode) {
                activeMultiplier = activeMultiplier === value ? 1 : value;
                document.getElementById('doubleBtn').classList.toggle('active-multiplier', activeMultiplier === 2);
                document.getElementById('tripleBtn').classList.toggle('active-multiplier', activeMultiplier === 3);
            }
        }

        function selectNumber(num) {
            if (isVoiceMode) return;
            if (throws.length >= maxThrows) return;
            
            const points = num * activeMultiplier;
            throws.push({
                base: num,
                multiplier: activeMultiplier,
                points: points
            });
            currentScore -= points;
            totalDarts++;
            saveState();
            updateDisplay();
            
            if (activeMultiplier !== 1) {
                toggleMultiplier(activeMultiplier);
            }
            
            if (throws.length >= maxThrows) {
                setTimeout(() => {
                    throws = [];
                    currentRound++;
                    saveState();
                    updateDisplay();
                }, 2000);
            }
        }

        function undoLastThrow() {
            if (history.length > 1) {
                history.pop();
                const lastState = history[history.length - 1];
                currentScore = lastState.score;
                throws = lastState.throws ? [...lastState.throws] : [];
                currentRound = lastState.round;
                totalDarts = lastState.totalDarts;
                updateDisplay();
            }
        }

        function resetGame() {
            currentScore = 501;
            throws = [];
            history = [{score: 501, throws: []}];
            activeMultiplier = 1;
            currentRound = 1;
            totalDarts = 0;
            isVoiceMode = false;
            document.querySelector('.container').classList.remove('voice-active');
            toggleMultiplier(1);
            updateDisplay();
        }

        const numberGrid = document.getElementById('numberGrid');
        const numbers = [...Array(20).keys()].map(i => i + 1);
        numbers.push(25, 0);
        for (const i of numbers) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.className = 'number-btn';
            btn.onclick = () => selectNumber(i);
            numberGrid.appendChild(btn);
        }

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'cs-CZ';
            recognition.continuous = true;
            recognition.interimResults = true;
            
            let processingTimeout = null;
            let isProcessing = false;
            
            recognition.onresult = function(event) {
                if (isProcessing) return;
                
                clearTimeout(processingTimeout);
                const transcript = event.results[0][0].transcript;
                console.log('Pr≈Øbƒõ≈æn√Ω text:', transcript);
                
                processingTimeout = setTimeout(() => {
                    if (isProcessing) return;
                    isProcessing = true;
                    
                    console.log('Fin√°ln√≠ text:', transcript);
                    
                    // Try to convert the spoken number
                    const number = convertSpokenNumberToCzech(transcript);
                    
                    if (number !== null) {
                        console.log('Odeƒç√≠t√°m:', number, 'od:', currentScore);
                        addVoiceScore(number);
                        recognition.stop();
                    }
                    
                    setTimeout(() => {
                        isProcessing = false;
                    }, 2000);
                }, 1500);
            };

            recognition.onstart = function() {
                isVoiceMode = true;
                document.querySelector('.container').classList.add('voice-active');
                updateDisplay();
            };

            recognition.onend = function() {
                isVoiceMode = false;
                document.querySelector('.container').classList.remove('voice-active');
                updateDisplay();
            };

            document.getElementById('voiceBtn').onclick = () => {
                console.log("Kliknuto na tlaƒç√≠tko hlasu");
                recognition.start();
            };
        } else {
            console.log("Hlasov√© rozpozn√°v√°n√≠ nen√≠ podporov√°no");
            document.getElementById('voiceBtn').style.display = 'none';
        }

        resetGame();
    </script>
</body>
</html>